name: Mirror Issue to Main Repo

on:
  issues:
    types: [opened]

jobs:
  mirror:
    name: Mirror Issue to Private Repo
    runs-on: ubuntu-latest
    steps:
      - name: Create Issue in Main Repo
        env:
          GH_TOKEN: ${{ secrets.MAIN_REPO_TOKEN }}
        run: |
          # Build a body that includes original issue metadata
          ORIGINAL_URL="${{ github.event.issue.html_url }}"
          ORIGINAL_AUTHOR="${{ github.event.issue.user.login }}"
          ORIGINAL_BODY=$(cat << 'BODY_EOF'
          ${{ github.event.issue.body }}
          BODY_EOF
          )

          FULL_BODY="**ðŸ“¥ KullanÄ±cÄ± bildirimi (Updates Repo'dan aktarÄ±ldÄ±)**

          > Orijinal issue: $ORIGINAL_URL
          > Bildiren: @$ORIGINAL_AUTHOR

          ---

          ${{ github.event.issue.body }}"

          # Ensure label exists (ignore error if it already exists)
          gh label create "user-report" \
            --repo "fatihgulsen/Gulsen.dev-ERP" \
            --description "KullanÄ±cÄ± tarafÄ±ndan bildirilen sorunlar" \
            --color "FBCA04" || true

          gh issue create \
            --repo "fatihgulsen/Gulsen.dev-ERP" \
            --title "[KullanÄ±cÄ±] ${{ github.event.issue.title }}" \
            --body "$FULL_BODY" \
            --label "user-report"

      - name: Comment on Original Issue
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: `âœ… Bildiriminiz alÄ±ndÄ±! Ekibimiz en kÄ±sa sÃ¼rede inceleyecektir.\n\nðŸ“§ Acil durumlar iÃ§in: **destek@gulsen.dev**`
            });
